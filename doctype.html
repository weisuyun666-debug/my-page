<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>沙特铜产品需求企业全景图</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', "Microsoft YaHei", sans-serif; background: #f0f2f5; }
        #map { width: 100vw; height: 100vh; }

        /* 企业标记样式 */
        .icon-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            color: white;
            border: 2px solid #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            z-index: 999;
        }

        /* 强制不重叠的标签样式 */
        .leaflet-tooltip-own {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #d35400;
            border-radius: 6px;
            padding: 5px 10px;
            font-size: 13px;
            font-weight: bold;
            color: #2c3e50;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            white-space: nowrap;
        }

        /* 颜色分类 */
        .bg-hvac { background-color: #e67e22; } /* 橙色-空调 */
        .bg-power { background-color: #2980b9; } /* 蓝色-电力 */
        .bg-factory { background-color: #27ae60; } /* 绿色-制造 */

        /* 顶部标题 */
        .header-title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(255,255,255,0.9);
            padding: 12px 30px;
            border-radius: 8px;
            border-bottom: 3px solid #d35400;
            text-align: center;
        }

        /* 图标含义说明面板 */
        .legend-panel {
            position: absolute;
            bottom: 30px;
            left: 20px;
            z-index: 1000;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            width: 240px;
        }
        .legend-title { font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; color: #d35400; }
        .legend-item { display: flex; align-items: center; margin-bottom: 8px; font-size: 12px; color: #555; }
        .legend-item i { width: 25px; margin-right: 10px; text-align: center; color: #d35400; }

    </style>
</head>
<body>

<div class="header-title">
    <h2 style="margin:0; font-size: 20px; color: #2c3e50;">沙特铜产品核心需求企业地图</h2>
</div>

<div class="legend-panel">
    <div class="legend-title">图标含义概述</div>
    <div class="legend-item"><i class="fa-solid fa-fan"></i> <b>暖通生产：</b>大型空调机组组装</div>
    <div class="legend-item"><i class="fa-solid fa-snowflake"></i> <b>精密制冷：</b>高端商业制冷系统</div>
    <div class="legend-item"><i class="fa-solid fa-bolt"></i> <b>电力设备：</b>变压器及铜排用件</div>
    <div class="legend-item"><i class="fa-solid fa-industry"></i> <b>合规工厂：</b>本地化生产制造基地</div>
    <div class="legend-item"><i class="fa-solid fa-warehouse"></i> <b>冷链设施：</b>仓储级工业制冷系统</div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map', { zoomControl: false }).setView([24.5, 45.0], 6);
    
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);

    // 企业数据 - 专门调整了 labelDirection 确保不重叠
    const companies = [
        { name: "Shaker Group", city: "利雅得 (Riyadh)", lat: 24.648, lng: 46.715, icon: "fa-fan", type: "bg-hvac", dir: "right" },
        { name: "Al Salem Johnson Controls", city: "吉达 (Jeddah)", lat: 21.616, lng: 39.156, icon: "fa-snowflake", type: "bg-hvac", dir: "top" },
        { name: "SAMCO (Carrier)", city: "吉达第一工业城", lat: 21.350, lng: 39.239, icon: "fa-industry", type: "bg-factory", dir: "bottom" },
        // 达曼集群：通过 top/bottom/left/right 彻底分散标注
        { name: "Zamil Air Conditioners", city: "达曼一工", lat: 26.425, lng: 50.093, icon: "fa-fan", type: "bg-hvac", dir: "top" },
        { name: "ABB", city: "达曼二工", lat: 26.150, lng: 50.000, icon: "fa-bolt", type: "bg-power", dir: "bottom" },
        { name: "Daikin Saudi Arabia", city: "达曼区", lat: 26.550, lng: 50.150, icon: "fa-fan", type: "bg-hvac", dir: "right" },
        { name: "FAWAZ Refrigeration", city: "达曼区", lat: 26.350, lng: 50.350, icon: "fa-warehouse", type: "bg-factory", dir: "left" }
    ];

    const markerGroup = new L.featureGroup();

    companies.forEach((co, index) => {
        setTimeout(() => {
            const iconHtml = L.divIcon({
                className: '',
                html: `<div class="icon-wrapper ${co.type}"><i class="fa-solid ${co.icon}"></i></div>`,
                iconSize: [36, 36],
                iconAnchor: [18, 18]
            });

            const marker = L.marker([co.lat, co.lng], { icon: iconHtml }).addTo(map);
            
            // 使用永久显示的 Tooltip，并通过 co.dir 控制弹出方向，防止重叠
            marker.bindTooltip(`
                <div style="text-align:center;">
                    ${co.name}<br>
                    <span style="font-weight:normal; font-size:11px; color:#666;">${co.city}</span>
                </div>`, 
                { 
                    permanent: true, 
                    direction: co.dir, 
                    className: 'leaflet-tooltip-own',
                    offset: co.dir === 'right' ? [15, 0] : co.dir === 'left' ? [-15, 0] : [0, 0]
                }
            );

            markerGroup.addLayer(marker);

            // 最终缩放
            if (index === companies.length - 1) {
                setTimeout(() => {
                    map.flyToBounds(markerGroup.getBounds().pad(0.3), { duration: 2 });
                }, 1000);
            }
        }, index * 800);
    });
</script>

</body>
</html>
